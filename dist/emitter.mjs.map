{"version":3,"sources":["../src/emitter.ts"],"sourcesContent":["export type EmitterEvent = {\n  [key: string]: any;\n  [key: number]: any;\n};\n\nexport type EventClass<T extends EmitterEvent> = new (...args: any[]) => T;\nexport type EventCallback<T extends EmitterEvent> = (event: T) => false | void;\ntype CallbackArray<T extends EmitterEvent> = Array<[EventCallback<T>, boolean] | undefined>;\n\nexport class EventEmitter {\n  protected readonly eventMap: WeakMap<EventClass<EmitterEvent>, CallbackArray<never>> = new WeakMap();\n\n  once<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>): this {\n    return this.set(event, callback, true);\n  }\n\n  on<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>): this {\n    return this.set(event, callback);\n  }\n\n  off<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>): this {\n    const events = this.eventMap.get(event);\n    if (events) {\n      const filtered = events.filter(ev => ev && ev[0] !== callback);\n      if (filtered.length > 0) {\n        this.eventMap.set(event, filtered);\n      }\n      else {\n        this.eventMap.delete(event);\n      }\n    }\n    return this;\n  }\n\n  emit<T extends EmitterEvent>(event: T): this {\n    const klass = event.constructor as EventClass<T>;\n    const events = this.eventMap.get(klass);\n    if (events) {\n      const length = events.length;\n      for (let i = 0; i < length; i++) {\n        const entry = events[i];\n        if (!entry) {\n          continue;\n        }\n        if (entry[1]) {\n          events[i] = undefined;\n        }\n        if (entry[0](event as never) === false) {\n          break;\n        }\n      }\n    }\n    return this;\n  }\n\n  protected set<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>, once: boolean = false): this {\n    const events = this.eventMap.get(event);\n    if (events) {\n      const filtered = events.filter(ev => ev && ev[0] !== callback);\n      this.eventMap.set(event, [...filtered, [callback, once]]);\n    }\n    else {\n      this.eventMap.set(event, [[callback, once]]);\n    }\n    return this;\n  }\n}\n"],"mappings":";AASO,IAAM,eAAN,MAAmB;AAAA,EAAnB;AACL,SAAmB,WAAoE,oBAAI,QAAQ;AAAA;AAAA,EAEnG,KAA6B,OAAsB,UAAkC;AACnF,WAAO,KAAK,IAAI,OAAO,UAAU,IAAI;AAAA,EACvC;AAAA,EAEA,GAA2B,OAAsB,UAAkC;AACjF,WAAO,KAAK,IAAI,OAAO,QAAQ;AAAA,EACjC;AAAA,EAEA,IAA4B,OAAsB,UAAkC;AAClF,UAAM,SAAS,KAAK,SAAS,IAAI,KAAK;AACtC,QAAI,QAAQ;AACV,YAAM,WAAW,OAAO,OAAO,QAAM,MAAM,GAAG,CAAC,MAAM,QAAQ;AAC7D,UAAI,SAAS,SAAS,GAAG;AACvB,aAAK,SAAS,IAAI,OAAO,QAAQ;AAAA,MACnC,OACK;AACH,aAAK,SAAS,OAAO,KAAK;AAAA,MAC5B;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEA,KAA6B,OAAgB;AAC3C,UAAM,QAAQ,MAAM;AACpB,UAAM,SAAS,KAAK,SAAS,IAAI,KAAK;AACtC,QAAI,QAAQ;AACV,YAAM,SAAS,OAAO;AACtB,eAAS,IAAI,GAAG,IAAI,QAAQ,KAAK;AAC/B,cAAM,QAAQ,OAAO,CAAC;AACtB,YAAI,CAAC,OAAO;AACV;AAAA,QACF;AACA,YAAI,MAAM,CAAC,GAAG;AACZ,iBAAO,CAAC,IAAI;AAAA,QACd;AACA,YAAI,MAAM,CAAC,EAAE,KAAc,MAAM,OAAO;AACtC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEU,IAA4B,OAAsB,UAA4B,OAAgB,OAAa;AACnH,UAAM,SAAS,KAAK,SAAS,IAAI,KAAK;AACtC,QAAI,QAAQ;AACV,YAAM,WAAW,OAAO,OAAO,QAAM,MAAM,GAAG,CAAC,MAAM,QAAQ;AAC7D,WAAK,SAAS,IAAI,OAAO,CAAC,GAAG,UAAU,CAAC,UAAU,IAAI,CAAC,CAAC;AAAA,IAC1D,OACK;AACH,WAAK,SAAS,IAAI,OAAO,CAAC,CAAC,UAAU,IAAI,CAAC,CAAC;AAAA,IAC7C;AACA,WAAO;AAAA,EACT;AACF;","names":[]}