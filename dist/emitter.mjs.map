{"version":3,"sources":["../src/emitter.ts"],"sourcesContent":["export type EmitterEvent = {\n  [key: string]: any;\n  [key: number]: any;\n};\n\nexport type EventClass<T extends EmitterEvent> = new (...args: any[]) => T;\nexport type EventCallback<T extends EmitterEvent> = (event: T) => false | void;\n\nclass EmitterCustomEvent extends Event {\n  event: EmitterEvent;\n  constructor(event: EmitterEvent) {\n    super(event.constructor.name);\n    this.event = event;\n  }\n}\n\nexport class EventEmitter {\n  protected eventTarget: EventTarget = new EventTarget();\n  protected eventMap: Map<EventClass<any>, WeakMap<EventCallback<any>, EventListener>> = new Map();\n\n  once<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>): this {\n    const wrapper = (e: T) => {\n      this.off(event, wrapper);\n      return callback(e);\n    };\n\n    return this.on(event, wrapper);\n  }\n\n  on<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>): this {\n    const listener = (e: Event) => {\n      if (callback((e as EmitterCustomEvent).event as T) === false) {\n        e.stopImmediatePropagation();\n      }\n    };\n\n    let map = this.eventMap.get(event);\n\n    if (map === undefined) {\n      map = new WeakMap();\n      this.eventMap.set(event, map);\n    }\n\n    map.set(callback, listener);\n\n    this.eventTarget.addEventListener(event.name, listener);\n\n    return this;\n  }\n\n  off<T extends EmitterEvent>(event: EventClass<T>, callback: EventCallback<T>): boolean {\n    const map = this.eventMap.get(event);\n\n    if (map !== undefined) {\n      const listener = map.get(callback);\n\n      if (listener !== undefined) {\n        this.eventTarget.removeEventListener(event.name, listener);\n        return map.delete(callback);\n      }\n    }\n\n    return false;\n  }\n\n  emit<T extends EmitterEvent>(event: T): this {\n    const customEvent = new EmitterCustomEvent(event);\n    this.eventTarget.dispatchEvent(customEvent);\n\n    return this;\n  }\n}\n"],"mappings":";AAQA,IAAM,qBAAN,cAAiC,MAAM;AAAA,EAErC,YAAY,OAAqB;AAC/B,UAAM,MAAM,YAAY,IAAI;AAC5B,SAAK,QAAQ;AAAA,EACf;AACF;AAEO,IAAM,eAAN,MAAmB;AAAA,EAAnB;AACL,SAAU,cAA2B,IAAI,YAAY;AACrD,SAAU,WAA6E,oBAAI,IAAI;AAAA;AAAA,EAE/F,KAA6B,OAAsB,UAAkC;AACnF,UAAM,UAAU,CAAC,MAAS;AACxB,WAAK,IAAI,OAAO,OAAO;AACvB,aAAO,SAAS,CAAC;AAAA,IACnB;AAEA,WAAO,KAAK,GAAG,OAAO,OAAO;AAAA,EAC/B;AAAA,EAEA,GAA2B,OAAsB,UAAkC;AACjF,UAAM,WAAW,CAAC,MAAa;AAC7B,UAAI,SAAU,EAAyB,KAAU,MAAM,OAAO;AAC5D,UAAE,yBAAyB;AAAA,MAC7B;AAAA,IACF;AAEA,QAAI,MAAM,KAAK,SAAS,IAAI,KAAK;AAEjC,QAAI,QAAQ,QAAW;AACrB,YAAM,oBAAI,QAAQ;AAClB,WAAK,SAAS,IAAI,OAAO,GAAG;AAAA,IAC9B;AAEA,QAAI,IAAI,UAAU,QAAQ;AAE1B,SAAK,YAAY,iBAAiB,MAAM,MAAM,QAAQ;AAEtD,WAAO;AAAA,EACT;AAAA,EAEA,IAA4B,OAAsB,UAAqC;AACrF,UAAM,MAAM,KAAK,SAAS,IAAI,KAAK;AAEnC,QAAI,QAAQ,QAAW;AACrB,YAAM,WAAW,IAAI,IAAI,QAAQ;AAEjC,UAAI,aAAa,QAAW;AAC1B,aAAK,YAAY,oBAAoB,MAAM,MAAM,QAAQ;AACzD,eAAO,IAAI,OAAO,QAAQ;AAAA,MAC5B;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,KAA6B,OAAgB;AAC3C,UAAM,cAAc,IAAI,mBAAmB,KAAK;AAChD,SAAK,YAAY,cAAc,WAAW;AAE1C,WAAO;AAAA,EACT;AACF;","names":[]}